<!-- Floating Search Button (Bottom Right) -->
<div class="search-floating-button" 
     *ngIf="isUserSignedIn && !isVisible"
     (click)="openSearch()"
     pTooltip="Search everything (Ctrl+K)"
     tooltipPosition="left">
  <i class="pi pi-search"></i>
  <span class="search-shortcut">⌘K</span>
</div>

<!-- Search Dialog -->
<p-dialog 
  [(visible)]="isVisible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="search-dialog"
  [style]="{width: '600px', maxWidth: '90vw'}"
  position="top"
  (onHide)="closeSearch()">
  
  <ng-template pTemplate="header">
    <div class="search-header">
      <i class="pi pi-search search-header-icon"></i>
      <span class="search-header-title">Universal Search</span>
      <div class="search-shortcuts">
        <span class="shortcut-hint">
          <kbd>↑</kbd><kbd>↓</kbd> navigate
        </span>
        <span class="shortcut-hint">
          <kbd>↵</kbd> select
        </span>
        <span class="shortcut-hint">
          <kbd>esc</kbd> close
        </span>
      </div>
    </div>
  </ng-template>

  <div class="search-content">
    <!-- Search Input -->
    <div class="search-input-container">
      <i class="pi pi-search search-input-icon"></i>
      <input 
        #searchInput
        type="text" 
        pInputText 
        [(ngModel)]="searchQuery"
        (input)="onSearchInput($event)"
        placeholder="Search everything: businesses, locations, pages, contacts..."
        class="search-input"
        autocomplete="off">
      <div class="search-loading" *ngIf="isLoading">
        <p-progressSpinner 
          [style]="{width: '20px', height: '20px'}" 
          strokeWidth="4">
        </p-progressSpinner>
      </div>
    </div>

    <!-- Search Results -->
    <div class="search-results" *ngIf="getDisplayResults().length > 0">
      <!-- Recent Searches Header -->
      <div class="search-section-header" *ngIf="showRecentSearches && recentSearches.length > 0">
        <span class="section-title">
          <i class="pi pi-history"></i>
          Recent Searches
        </span>
        <button 
          pButton 
          type="button" 
          icon="pi pi-times" 
          class="p-button-text p-button-sm clear-button"
          (click)="clearRecentSearches()"
          pTooltip="Clear recent searches">
        </button>
      </div>

      <!-- Search Results Header -->
      <div class="search-section-header" *ngIf="!showRecentSearches && searchResults.length > 0">
        <span class="section-title">
          <i class="pi pi-search"></i>
          Search Results
        </span>
        <span class="results-count">{{searchResults.length}} result{{searchResults.length !== 1 ? 's' : ''}}</span>
      </div>

      <!-- Results List -->
      <div class="search-results-list">
        <div 
          *ngFor="let result of getDisplayResults(); let i = index"
          class="search-result-item"
          [class.selected]="i === selectedIndex"
          (click)="selectResult(result)"
          (mouseenter)="selectedIndex = i">
          
          <div class="result-icon">
            <i [class]="getResultIcon(result)"></i>
          </div>
          
          <div class="result-content">
            <div class="result-title">
              {{getResultTitle(result)}}
            </div>
            <div class="result-description">
              {{getResultDescription(result)}}
            </div>
          </div>
          
          <div class="result-meta" *ngIf="!('query' in result)">
            <p-tag 
              [value]="getResultTypeLabel(result.type)" 
              [severity]="getTagSeverity(result.type)"
              [class]="getResultTypeClass(result.type)">
            </p-tag>
          </div>
          
          <div class="result-action">
            <i class="pi pi-arrow-right"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- No Results -->
    <div class="no-results" *ngIf="!isLoading && searchQuery && searchResults.length === 0 && !showRecentSearches">
      <div class="no-results-icon">
        <i class="pi pi-search"></i>
      </div>
      <div class="no-results-title">No results found</div>
      <div class="no-results-description">
        Try different keywords or check your spelling. Our smart search handles typos and finds similar matches!
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!isLoading && !searchQuery && recentSearches.length === 0">
      <div class="empty-state-icon">
        <i class="pi pi-search"></i>
      </div>
      <div class="empty-state-title">Search everything</div>
      <div class="empty-state-description">
        Find businesses, locations, contacts, pages, sections, and everything across your ServiceFuzz account. Try fuzzy searches - even if your spelling isn't perfect!
      </div>
      <div class="search-tips">
        <div class="tip-item">
          <i class="pi pi-building"></i>
          <span>Search businesses & locations</span>
        </div>
        <div class="tip-item">
          <i class="pi pi-globe"></i>
          <span>Find pages & sections</span>
        </div>
        <div class="tip-item">
          <i class="pi pi-phone"></i>
          <span>Contact information</span>
        </div>
        <div class="tip-item">
          <i class="pi pi-bookmark"></i>
          <span>Website content & features</span>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="search-footer">
      <div class="search-footer-left">
        <span class="footer-hint">
          <i class="pi pi-info-circle"></i>
          Press <kbd>Ctrl+K</kbd> anytime to search
        </span>
      </div>
      <div class="search-footer-right">
        <span class="footer-powered">
          Powered by ServiceFuzz
        </span>
      </div>
    </div>
  </ng-template>
</p-dialog>
