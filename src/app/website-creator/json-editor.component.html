<!-- File Browser Component -->
<div class="file-browser-container">
  <!-- Header -->
  <div class="file-browser-header">
    <div class="header-left">
      <div class="header-title">
        <i class="pi pi-folder-open"></i>
        <span>File Browser</span>
      </div>
      <div class="file-count" *ngIf="files.length > 0">
        {{ files.length }} files
      </div>
    </div>
    <div class="header-actions">
      <button 
        class="action-btn refresh-btn" 
        (click)="onRefresh()" 
        [disabled]="isLoadingFiles"
        title="Refresh files">
        <i class="pi pi-refresh" [class.pi-spin]="isLoadingFiles"></i>
      </button>
      <button 
        class="action-btn close-btn" 
        (click)="closeEditor()"
        title="Close file browser">
        <i class="pi pi-times"></i>
      </button>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-container">
    <div class="search-input-wrapper">
      <i class="pi pi-search search-icon"></i>
      <input 
        type="text" 
        class="search-input"
        placeholder="Search files..."
        [(ngModel)]="searchTerm"
        (input)="onSearch()">
    </div>
  </div>

  <!-- Main Content -->
  <div class="file-browser-content">
    <!-- Left Panel - File Tree -->
    <div class="file-tree-panel">
      <div class="panel-header">
        <span class="panel-title">Files</span>
      </div>
      
      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoadingFiles">
        <div class="loading-spinner">
          <i class="pi pi-spin pi-spinner"></i>
        </div>
        <p>Loading files...</p>
      </div>

      <!-- File Tree -->
      <div class="file-tree-container" *ngIf="!isLoadingFiles">
        <p-tree 
          [value]="filteredTree"
          selectionMode="single"
          [(selection)]="selectedFile"
          (onNodeSelect)="onFileSelect($event)"
          [loading]="isLoadingFiles"
          styleClass="github-tree">
          
          <ng-template let-node pTemplate="default">
            <div class="tree-node-content">
              <span class="node-label">{{ node.label }}</span>
              <span class="file-size" *ngIf="node.leaf && node.data?.fileSize">
                {{ getFileSize(node.data.fileSize) }}
              </span>
            </div>
          </ng-template>
        </p-tree>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredTree.length === 0 && !isLoadingFiles">
          <div class="empty-icon">
            <i class="pi pi-folder-open"></i>
          </div>
          <p *ngIf="searchTerm">No files match your search</p>
          <p *ngIf="!searchTerm">No files found</p>
        </div>
      </div>
    </div>

    <!-- Right Panel - File Content -->
    <div class="file-content-panel">
      <div class="panel-header" *ngIf="selectedFile">
        <div class="file-info">
          <i [class]="getFileIcon(selectedFileType)" class="file-type-icon"></i>
          <span class="file-name">{{ selectedFileName }}</span>
          <span class="file-type-badge">{{ selectedFileType.toUpperCase() }}</span>
        </div>
      </div>

      <!-- Content Area -->
      <div class="content-area">
        <!-- No File Selected -->
        <div class="no-selection" *ngIf="!selectedFile">
          <div class="no-selection-icon">
            <i class="pi pi-file"></i>
          </div>
          <h3>Select a file to view its contents</h3>
          <p>Choose a file from the tree on the left to see its content here.</p>
        </div>

        <!-- Loading Content -->
        <div class="loading-content" *ngIf="selectedFile && isLoadingContent">
          <div class="loading-spinner">
            <i class="pi pi-spin pi-spinner"></i>
          </div>
          <p>Loading file content...</p>
        </div>

        <!-- File Content -->
        <div class="file-content-container" *ngIf="selectedFile && !isLoadingContent">
          <div class="content-header">
            <div class="content-stats">
              <span class="line-count">{{ lineCount }} lines</span>
              <span class="char-count">{{ fileContent.length }} characters</span>
            </div>
          </div>
          
          <div class="code-container" #codeContainer>
            <div class="code-wrapper">
              <!-- Code Content with Syntax Highlighting and Line Numbers -->
              <div class="code-content-wrapper">
                <pre class="code-content">
                  <code 
                    [highlight]="fileContent" 
                    [language]="getHighlightLanguage(selectedFileType)"
                    lineNumbers 
                    (highlighted)="onHighlighted($event)">
                  </code>
                </pre>
                <!-- Debug info -->
                <div class="debug-info" style="font-size: 10px; color: #666; margin-top: 5px;">
                  Language: {{ getHighlightLanguage(selectedFileType) }} | Content: {{ fileContent.length }} chars
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>