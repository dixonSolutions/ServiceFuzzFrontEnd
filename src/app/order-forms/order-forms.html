<!-- Enhanced Order Forms with Form Builder -->
<div class="order-forms-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="8" fill="var(--surface-ground)" animationDuration=".5s"></p-progressSpinner>
    <p class="loading-text">Loading your forms...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading" class="content-wrapper">
    
    <!-- Header with Navigation Breadcrumb -->
    <div class="header-section">
      <p-card class="header-card">
        <div class="header-content">
          <div class="breadcrumb-section">
            <p-button 
              icon="pi pi-home" 
              severity="secondary" 
              [text]="true" 
              (onClick)="navigateToFormsList()"
              class="breadcrumb-btn">
            </p-button>
            <i class="pi pi-angle-right breadcrumb-separator"></i>
            <span class="breadcrumb-text">Business</span>
            <i class="pi pi-angle-right breadcrumb-separator"></i>
            <span class="breadcrumb-text">Order Forms</span>
            <i *ngIf="currentView === 'single' && selectedForm" class="pi pi-angle-right breadcrumb-separator"></i>
            <span *ngIf="currentView === 'single' && selectedForm" class="breadcrumb-text">{{ selectedForm.name }}</span>
            <i *ngIf="currentView === 'all'" class="pi pi-angle-right breadcrumb-separator"></i>
            <span *ngIf="currentView === 'all'" class="breadcrumb-text">All Forms</span>
            <i *ngIf="currentView === 'create'" class="pi pi-angle-right breadcrumb-separator"></i>
            <span *ngIf="currentView === 'create'" class="breadcrumb-text">Create Form</span>
            <i *ngIf="currentView === 'edit'" class="pi pi-angle-right breadcrumb-separator"></i>
            <span *ngIf="currentView === 'edit'" class="breadcrumb-text">Edit Form</span>
          </div>
          
          <div class="header-title">
            <div class="title-section">
              <h1 *ngIf="currentView === 'list'">
                <i class="pi pi-file-edit"></i>
                Order Forms Management
              </h1>
              <h1 *ngIf="currentView === 'all'">
                <i class="pi pi-table"></i>
                All Order Forms
              </h1>
              <h1 *ngIf="currentView === 'single' && selectedForm">
                <i class="pi pi-eye"></i>
                {{ selectedForm.name }}
              </h1>
              <h1 *ngIf="currentView === 'create'">
                <i class="pi pi-plus"></i>
                Create New Form
              </h1>
              <h1 *ngIf="currentView === 'edit' && builderState?.currentForm">
                <i class="pi pi-pencil"></i>
                Edit {{ builderState?.currentForm?.formName }}
              </h1>
            </div>
            <p class="header-subtitle" *ngIf="currentView === 'list'">Create and manage professional order forms for your business</p>
            <p class="header-subtitle" *ngIf="currentView === 'all'">Complete overview with analytics and management tools</p>
            <p class="header-subtitle" *ngIf="currentView === 'single' && selectedForm">{{ selectedForm.description }}</p>
            <p class="header-subtitle" *ngIf="currentView === 'create'">Design custom forms with drag-and-drop components</p>
            <p class="header-subtitle" *ngIf="currentView === 'edit'">Modify your form components and settings</p>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Form Builder View (Create/Edit) -->
    <div *ngIf="currentView === 'create' || currentView === 'edit'" class="form-builder-view">
      
      <!-- Builder Toolbar -->
      <div class="builder-toolbar">
        <div class="toolbar-left">
          <p-button 
            label="Back to Forms" 
            icon="pi pi-arrow-left" 
            severity="secondary"
            [outlined]="true"
            (onClick)="cancelEditing()">
          </p-button>
          <p-divider layout="vertical"></p-divider>
          <p-button 
            [icon]="builderState?.isPreviewMode ? 'pi pi-pencil' : 'pi pi-eye'" 
            [label]="builderState?.isPreviewMode ? 'Edit Mode' : 'Preview Mode'"
            severity="info"
            [outlined]="true"
            (onClick)="togglePreviewMode()">
          </p-button>
        </div>
        
        <div class="toolbar-center">
          <span class="form-name" *ngIf="builderState?.currentForm">
            {{ builderState?.currentForm?.formName }}
            <p-tag *ngIf="builderState?.isDirty" value="Unsaved" severity="warn"></p-tag>
          </span>
        </div>
        
        <div class="toolbar-right">
          <p-button 
            label="Save Form" 
            icon="pi pi-save" 
            severity="success"
            [disabled]="hasValidationErrors()"
            (onClick)="saveForm()">
          </p-button>
          <p-button 
            icon="pi pi-cog" 
            severity="secondary"
            [outlined]="true"
            pTooltip="Form Settings"
            (onClick)="showFormSettings = true">
          </p-button>
        </div>
      </div>

      <!-- Builder Content -->
      <div class="builder-content">
        
        <!-- Component Library Sidebar -->
        <div class="component-library" [class.collapsed]="!showComponentLibrary">
          <div class="library-header">
            <h3>
              <i class="pi pi-th-large"></i>
              Components
            </h3>
            <p-button 
              icon="pi pi-times" 
              severity="secondary"
              [text]="true"
              [rounded]="true"
              size="small"
              (onClick)="showComponentLibrary = false">
            </p-button>
          </div>
          
          <div class="library-content">
            <p-accordion [multiple]="true">
              
              <!-- Basic Input Components -->
              <p-accordionTab header="Basic Input" [selected]="true">
                <div class="component-group">
                  <div 
                    *ngFor="let type of getComponentTypes()['Basic Input']" 
                    class="component-item"
                    [attr.data-component-type]="type"
                    (click)="addComponent(type)">
                    <div class="component-icon">
                      <i class="pi" [ngClass]="getComponentMetadata(type).icon"></i>
                    </div>
                    <div class="component-info">
                      <span class="component-name">{{ getComponentMetadata(type).name }}</span>
                      <small class="component-description">{{ getComponentMetadata(type).description }}</small>
                    </div>
                  </div>
                </div>
              </p-accordionTab>

              <!-- Selection Components -->
              <p-accordionTab header="Selection">
                <div class="component-group">
                  <div 
                    *ngFor="let type of getComponentTypes()['Selection']" 
                    class="component-item"
                    [attr.data-component-type]="type"
                    (click)="addComponent(type)">
                    <div class="component-icon">
                      <i class="pi" [ngClass]="getComponentMetadata(type).icon"></i>
                    </div>
                    <div class="component-info">
                      <span class="component-name">{{ getComponentMetadata(type).name }}</span>
                      <small class="component-description">{{ getComponentMetadata(type).description }}</small>
                    </div>
                  </div>
                </div>
              </p-accordionTab>

              <!-- Date & Time Components -->
              <p-accordionTab header="Date & Time">
                <div class="component-group">
                  <div 
                    *ngFor="let type of getComponentTypes()['Date & Time']" 
                    class="component-item"
                    [attr.data-component-type]="type"
                    (click)="addComponent(type)">
                    <div class="component-icon">
                      <i class="pi" [ngClass]="getComponentMetadata(type).icon"></i>
                    </div>
                    <div class="component-info">
                      <span class="component-name">{{ getComponentMetadata(type).name }}</span>
                      <small class="component-description">{{ getComponentMetadata(type).description }}</small>
                    </div>
                  </div>
                </div>
              </p-accordionTab>

              <!-- File Upload Components -->
              <p-accordionTab header="File Upload">
                <div class="component-group">
                  <div 
                    *ngFor="let type of getComponentTypes()['File Upload']" 
                    class="component-item"
                    [attr.data-component-type]="type"
                    (click)="addComponent(type)">
                    <div class="component-icon">
                      <i class="pi" [ngClass]="getComponentMetadata(type).icon"></i>
                    </div>
                    <div class="component-info">
                      <span class="component-name">{{ getComponentMetadata(type).name }}</span>
                      <small class="component-description">{{ getComponentMetadata(type).description }}</small>
                    </div>
                  </div>
                </div>
              </p-accordionTab>

              <!-- Advanced Components -->
              <p-accordionTab header="Advanced">
                <div class="component-group">
                  <div 
                    *ngFor="let type of getComponentTypes()['Advanced']" 
                    class="component-item"
                    [attr.data-component-type]="type"
                    (click)="addComponent(type)">
                    <div class="component-icon">
                      <i class="pi" [ngClass]="getComponentMetadata(type).icon"></i>
                    </div>
                    <div class="component-info">
                      <span class="component-name">{{ getComponentMetadata(type).name }}</span>
                      <small class="component-description">{{ getComponentMetadata(type).description }}</small>
                    </div>
                  </div>
                </div>
              </p-accordionTab>

              <!-- Display Components -->
              <p-accordionTab header="Display">
                <div class="component-group">
                  <div 
                    *ngFor="let type of getComponentTypes()['Display']" 
                    class="component-item"
                    [attr.data-component-type]="type"
                    (click)="addComponent(type)">
                    <div class="component-icon">
                      <i class="pi" [ngClass]="getComponentMetadata(type).icon"></i>
                    </div>
                    <div class="component-info">
                      <span class="component-name">{{ getComponentMetadata(type).name }}</span>
                      <small class="component-description">{{ getComponentMetadata(type).description }}</small>
                    </div>
                  </div>
                </div>
              </p-accordionTab>

            </p-accordion>
          </div>
        </div>

        <!-- Form Canvas -->
        <div class="form-canvas" [class.preview-mode]="builderState?.isPreviewMode">
          
          <!-- Canvas Header -->
          <div class="canvas-header">
            <div class="canvas-title">
              <input 
                [(ngModel)]="builderState!.currentForm!.formName" 
                (ngModelChange)="updateFormProperty('formName', $event)"
                class="form-name-input"
                placeholder="Enter form name..."
                *ngIf="!builderState?.isPreviewMode && builderState?.currentForm">
              <h2 *ngIf="builderState?.isPreviewMode">{{ builderState?.currentForm?.formName }}</h2>
            </div>
            
            <div class="canvas-description" *ngIf="!builderState?.isPreviewMode">
              <textarea 
                [(ngModel)]="builderState!.currentForm!.description"
                (ngModelChange)="updateFormProperty('description', $event)"
                class="form-description-input"
                placeholder="Enter form description..."
                rows="2"
                *ngIf="builderState?.currentForm">
              </textarea>
            </div>
            <p *ngIf="builderState?.isPreviewMode && builderState?.currentForm?.description">
              {{ builderState?.currentForm?.description }}
            </p>
          </div>

          <!-- Validation Errors -->
          <div *ngIf="validationErrors.length > 0" class="validation-errors">
            <p-message 
              *ngFor="let error of validationErrors" 
              [severity]="error.severity"
              [text]="error.message"
              [style]="{'margin-bottom': '0.5rem'}">
            </p-message>
          </div>

          <!-- Form Components Canvas -->
          <div class="canvas-body">
            
            <!-- Empty State -->
            <div *ngIf="!builderState?.currentForm?.components?.length" class="empty-canvas">
              <div class="empty-icon">
                <i class="pi pi-plus-circle"></i>
              </div>
              <h3>Start Building Your Form</h3>
              <p>Add components from the sidebar to create your custom order form</p>
              <p-button 
                label="Add First Component" 
                icon="pi pi-plus" 
                severity="success"
                [outlined]="true"
                (onClick)="showComponentLibrary = true">
              </p-button>
            </div>

            <!-- Form Components -->
            <div *ngIf="builderState?.currentForm?.components?.length" class="form-components">
              <div 
                *ngFor="let component of builderState?.currentForm?.components; let i = index"
                class="form-component"
                [class.selected]="builderState?.selectedComponent?.id === component.id"
                [class.preview-mode]="builderState?.isPreviewMode"
                (click)="selectComponent(component)">
                
                <!-- Component Header (Edit Mode Only) -->
                <div *ngIf="!builderState?.isPreviewMode" class="component-header">
                  <div class="component-title">
                    <i class="pi" [ngClass]="getComponentMetadata(component.type).icon"></i>
                    <span>{{ component.label || getComponentMetadata(component.type).name }}</span>
                    <p-tag *ngIf="component.required" value="Required" severity="danger" size="small"></p-tag>
                  </div>
                  <div class="component-actions">
                    <p-button 
                      icon="pi pi-clone" 
                      severity="secondary"
                      [text]="true"
                      [rounded]="true"
                      size="small"
                      pTooltip="Duplicate">
                    </p-button>
                    <p-button 
                      icon="pi pi-trash" 
                      severity="danger"
                      [text]="true"
                      [rounded]="true"
                      size="small"
                      pTooltip="Delete"
                      (onClick)="removeComponent(component.id)">
                    </p-button>
                  </div>
                </div>

                <!-- Component Content -->
                <div class="component-content">
                  
                  <!-- Text Input Components -->
                  <div *ngIf="component.type === CustomFormComponentType.TEXT || 
                             component.type === CustomFormComponentType.EMAIL || 
                             component.type === CustomFormComponentType.PHONE ||
                             component.type === CustomFormComponentType.PASSWORD">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <input 
                      pInputText 
                      [type]="component.type === CustomFormComponentType.PASSWORD ? 'password' : 'text'"
                      [placeholder]="component.placeholder || 'Enter ' + component.label.toLowerCase()"
                      [disabled]="builderState?.isPreviewMode"
                      class="component-input">
                  </div>

                  <!-- Number Input -->
                  <div *ngIf="component.type === CustomFormComponentType.NUMBER">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-inputNumber 
                      [placeholder]="component.placeholder || 'Enter number'"
                      [disabled]="builderState?.isPreviewMode"
                      class="component-input">
                    </p-inputNumber>
                  </div>

                  <!-- Textarea -->
                  <div *ngIf="component.type === CustomFormComponentType.TEXTAREA">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <textarea 
                      pTextarea 
                      [placeholder]="component.placeholder || 'Enter detailed information'"
                      [disabled]="builderState?.isPreviewMode"
                      class="component-input"
                      rows="3">
                    </textarea>
                  </div>

                  <!-- Dropdown -->
                  <div *ngIf="component.type === CustomFormComponentType.DROPDOWN">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-dropdown 
                      [options]="component.options || []"
                      [placeholder]="component.placeholder || 'Select an option'"
                      [disabled]="builderState?.isPreviewMode"
                      class="component-input">
                    </p-dropdown>
                  </div>

                  <!-- MultiSelect -->
                  <div *ngIf="component.type === CustomFormComponentType.MULTISELECT">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-multiSelect 
                      [options]="component.options || []"
                      [placeholder]="component.placeholder || 'Select multiple options'"
                      [disabled]="builderState?.isPreviewMode"
                      class="component-input">
                    </p-multiSelect>
                  </div>

                  <!-- Radio Buttons -->
                  <div *ngIf="component.type === CustomFormComponentType.RADIO">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <div class="radio-group">
                      <div *ngFor="let option of component.options || []" class="radio-option">
                        <p-radioButton 
                          [value]="option.value || option"
                          [disabled]="builderState?.isPreviewMode">
                        </p-radioButton>
                        <label>{{ option.label || option }}</label>
                      </div>
                    </div>
                  </div>

                  <!-- Checkbox Group -->
                  <div *ngIf="component.type === CustomFormComponentType.CHECKBOX_GROUP">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <div class="checkbox-group">
                      <div *ngFor="let option of component.options || []" class="checkbox-option">
                        <p-checkbox 
                          [value]="option.value || option"
                          [disabled]="builderState?.isPreviewMode">
                        </p-checkbox>
                        <label>{{ option.label || option }}</label>
                      </div>
                    </div>
                  </div>

                  <!-- Single Checkbox -->
                  <div *ngIf="component.type === CustomFormComponentType.CHECKBOX">
                    <div class="checkbox-single">
                      <p-checkbox 
                        [disabled]="builderState?.isPreviewMode">
                      </p-checkbox>
                      <label class="component-label">{{ component.label }}</label>
                    </div>
                  </div>

                  <!-- Calendar -->
                  <div *ngIf="component.type === CustomFormComponentType.CALENDAR">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-calendar 
                      [placeholder]="component.placeholder || 'Select date'"
                      [disabled]="builderState?.isPreviewMode"
                      [showIcon]="true"
                      class="component-input">
                    </p-calendar>
                  </div>

                  <!-- Calendar Range -->
                  <div *ngIf="component.type === CustomFormComponentType.CALENDAR_RANGE">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-calendar 
                      [placeholder]="component.placeholder || 'Select date range'"
                      [disabled]="builderState?.isPreviewMode"
                      [selectionMode]="'range'"
                      [showIcon]="true"
                      class="component-input">
                    </p-calendar>
                  </div>

                  <!-- Time -->
                  <div *ngIf="component.type === CustomFormComponentType.TIME">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-calendar 
                      [placeholder]="component.placeholder || 'Select time'"
                      [disabled]="builderState?.isPreviewMode"
                      [timeOnly]="true"
                      [showIcon]="true"
                      class="component-input">
                    </p-calendar>
                  </div>

                  <!-- DateTime -->
                  <div *ngIf="component.type === CustomFormComponentType.DATETIME">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-calendar 
                      [placeholder]="component.placeholder || 'Select date and time'"
                      [disabled]="builderState?.isPreviewMode"
                      [showTime]="true"
                      [showIcon]="true"
                      class="component-input">
                    </p-calendar>
                  </div>

                  <!-- File Upload -->
                  <div *ngIf="component.type === CustomFormComponentType.FILE">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-fileUpload 
                      mode="basic"
                      [disabled]="builderState?.isPreviewMode"
                      chooseLabel="Choose File"
                      class="component-input">
                    </p-fileUpload>
                  </div>

                  <!-- Image Upload -->
                  <div *ngIf="component.type === CustomFormComponentType.IMAGE">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-fileUpload 
                      mode="basic"
                      [disabled]="builderState?.isPreviewMode"
                      accept="image/*"
                      chooseLabel="Choose Image"
                      class="component-input">
                    </p-fileUpload>
                  </div>

                  <!-- Rating -->
                  <div *ngIf="component.type === CustomFormComponentType.RATING">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-rating 
                      [disabled]="builderState?.isPreviewMode"
                      [stars]="5"
                      class="component-input">
                    </p-rating>
                  </div>

                  <!-- Slider -->
                  <div *ngIf="component.type === CustomFormComponentType.SLIDER">
                    <label class="component-label">
                      {{ component.label }}
                      <span *ngIf="component.required" class="required-asterisk">*</span>
                    </label>
                    <p-slider 
                      [disabled]="builderState?.isPreviewMode"
                      class="component-input">
                    </p-slider>
                  </div>

                  <!-- Heading -->
                  <div *ngIf="component.type === CustomFormComponentType.HEADING">
                    <h3 class="component-heading">{{ component.label }}</h3>
                  </div>

                  <!-- Paragraph -->
                  <div *ngIf="component.type === CustomFormComponentType.PARAGRAPH">
                    <p class="component-paragraph">{{ component.description || component.label }}</p>
                  </div>

                  <!-- Divider -->
                  <div *ngIf="component.type === CustomFormComponentType.DIVIDER">
                    <p-divider></p-divider>
                  </div>

                </div>

              </div>
            </div>

            <!-- Submit Button (Preview Mode Only) -->
            <div *ngIf="builderState?.isPreviewMode" class="form-submit">
              <p-button 
                label="Submit Form" 
                icon="pi pi-check" 
                size="large"
                [style]="{'width': '100%', 'margin-top': '2rem'}"
                [disabled]="true">
              </p-button>
            </div>

          </div>
        </div>

        <!-- Properties Panel -->
        <div class="properties-panel" *ngIf="builderState?.selectedComponent && !builderState?.isPreviewMode">
          <div class="panel-header">
            <h3>
              <i class="pi pi-cog"></i>
              Component Properties
            </h3>
          </div>
          
          <div class="panel-content">
            <div class="property-group">
              <label>Label</label>
              <input 
                pInputText 
                [ngModel]="builderState?.selectedComponent?.label || ''"
                (ngModelChange)="updateComponent(builderState?.selectedComponent?.id || '', { label: $event })"
                placeholder="Enter component label">
            </div>

            <div class="property-group">
              <label>Placeholder</label>
              <input 
                pInputText 
                [ngModel]="builderState?.selectedComponent?.placeholder || ''"
                (ngModelChange)="updateComponent(builderState?.selectedComponent?.id || '', { placeholder: $event })"
                placeholder="Enter placeholder text">
            </div>

            <div class="property-group">
              <p-checkbox 
                [ngModel]="builderState?.selectedComponent?.required || false"
                (ngModelChange)="updateComponent(builderState?.selectedComponent?.id || '', { required: $event })"
                label="Required field">
              </p-checkbox>
            </div>

            <!-- Options for select/radio/checkbox components -->
            <div *ngIf="hasSelectedComponentWithOptions()" 
                 class="property-group">
              <label>Options</label>
              <div class="options-editor">
                <div *ngFor="let option of builderState?.selectedComponent?.options || []; let i = index" class="option-item">
                  <input 
                    pInputText 
                    [(ngModel)]="option.label"
                    placeholder="Option label">
                  <p-button 
                    icon="pi pi-trash" 
                    severity="danger"
                    [text]="true"
                    size="small">
                  </p-button>
                </div>
                <p-button 
                  label="Add Option" 
                  icon="pi pi-plus" 
                  severity="success"
                  [outlined]="true"
                  size="small">
                </p-button>
              </div>
            </div>

          </div>
        </div>

      </div>
    </div>

    <!-- List View - Default forms overview -->
    <div *ngIf="currentView === 'list'" class="list-view">
      
      <!-- Enhanced Action Bar -->
      <div class="action-bar">
        <div class="primary-actions">
          <p-button 
            label="Create New Form" 
            icon="pi pi-plus" 
            severity="success"
            class="action-btn primary-btn"
            (onClick)="createNewForm()">
          </p-button>
          <p-button 
            label="Browse Templates" 
            icon="pi pi-clone" 
            severity="info"
            [outlined]="true"
            class="action-btn"
            (onClick)="openTemplateDialog()">
          </p-button>
        </div>
        <div class="secondary-actions">
          <p-button 
            label="View All Forms" 
            icon="pi pi-list" 
            severity="secondary"
            [outlined]="true"
            class="action-btn"
            (onClick)="navigateToAllForms()">
          </p-button>
          <p-button 
            icon="pi pi-download" 
            severity="secondary"
            [outlined]="true"
            pTooltip="Export Forms"
            class="action-btn icon-only">
          </p-button>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-icon success">
            <i class="pi pi-check-circle"></i>
          </div>
          <div class="stat-content">
                         <span class="stat-number">{{ activeFormsCount }}</span>
            <span class="stat-label">Active Forms</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon info">
            <i class="pi pi-chart-bar"></i>
          </div>
          <div class="stat-content">
                         <span class="stat-number">{{ totalOrdersCount }}</span>
            <span class="stat-label">Total Orders</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon warn">
            <i class="pi pi-clock"></i>
          </div>
          <div class="stat-content">
                         <span class="stat-number">{{ draftFormsCount }}</span>
            <span class="stat-label">Draft Forms</span>
          </div>
        </div>
      </div>

      <!-- Enhanced Forms Grid -->
      <div class="forms-grid">
        <div *ngFor="let form of forms" class="form-card-wrapper">
          <p-card class="form-card" [ngClass]="'status-' + form.status">
            
            <!-- Card Header with Status and Quick Actions -->
            <ng-template pTemplate="header">
              <div class="card-header">
                <div class="status-section">
                  <p-tag 
                    [value]="form.status | titlecase" 
                    [severity]="getStatusSeverity(form.status)"
                    [icon]="getStatusIcon(form.status)"
                    class="status-tag">
                  </p-tag>
                  <div class="publication-status">
                    <i class="pi" [ngClass]="form.isPublished ? 'pi-globe' : 'pi-lock'" 
                       [pTooltip]="form.isPublished ? 'Published Online' : 'Private Draft'"></i>
                  </div>
                </div>
                <div class="quick-actions">
                  <p-button 
                    icon="pi pi-eye" 
                    severity="info" 
                    [text]="true"
                    [rounded]="true"
                    pTooltip="View Details"
                    class="quick-action-btn"
                    (onClick)="navigateToForm(form.id)">
                  </p-button>
                  <p-button 
                    icon="pi pi-pencil" 
                    severity="warn" 
                    [text]="true"
                    [rounded]="true"
                    pTooltip="Edit Form"
                    class="quick-action-btn"
                    (onClick)="editForm(form.id)">
                  </p-button>
                  <p-button 
                    [icon]="form.status === FormStatus.ACTIVE ? 'pi pi-pause' : 'pi pi-play'" 
                    [severity]="form.status === FormStatus.ACTIVE ? 'warn' : 'success'" 
                    [text]="true"
                    [rounded]="true"
                    [pTooltip]="form.status === FormStatus.ACTIVE ? 'Pause Form' : 'Activate Form'"
                    class="quick-action-btn"
                    (onClick)="toggleFormStatus(form.id)">
                  </p-button>
                </div>
              </div>
            </ng-template>

            <!-- Enhanced Card Content -->
            <div class="card-content">
              <div class="form-header">
                <h3 class="form-title">
                  <i class="pi pi-file-edit form-icon"></i>
                  {{ form.name }}
                </h3>
                <div class="form-url" *ngIf="form.formUrl">
                  <p-button 
                    icon="pi pi-copy" 
                    severity="secondary" 
                    [text]="true"
                    [rounded]="true"
                    size="small"
                    pTooltip="Copy Form URL"
                    (onClick)="copyFormUrl(form.formUrl!)">
                  </p-button>
                </div>
              </div>
              
              <p class="form-description">{{ form.description }}</p>
              
              <!-- Analytics Preview -->
              <div class="analytics-preview">
                <div class="analytics-item">
                  <i class="pi pi-eye"></i>
                  <span class="analytics-value">{{ form.analytics.totalViews }}</span>
                  <span class="analytics-label">Views</span>
                </div>
                <div class="analytics-item">
                  <i class="pi pi-percentage"></i>
                  <span class="analytics-value">{{ form.analytics.conversionRate }}%</span>
                  <span class="analytics-label">Conversion</span>
                </div>
                <div class="analytics-item">
                  <i class="pi pi-clock"></i>
                  <span class="analytics-value">{{ form.analytics.averageCompletionTime }}m</span>
                  <span class="analytics-label">Avg Time</span>
                </div>
              </div>

              <!-- Form Stats -->
              <div class="form-stats">
                <div class="stat-item">
                  <i class="pi pi-calendar"></i>
                  <span>{{ form.createdDate | date:'mediumDate' }}</span>
                </div>
                <div class="stat-item highlight">
                  <i class="pi pi-shopping-cart"></i>
                  <strong>{{ form.totalOrders }} orders</strong>
                </div>
                <div class="stat-item">
                  <i class="pi pi-list"></i>
                  <span>{{ form.fields.length }} fields</span>
                </div>
              </div>
            </div>

            <!-- Enhanced Card Footer -->
            <ng-template pTemplate="footer">
              <div class="card-footer">
                <div class="action-buttons">
                  <p-button 
                    label="View & Edit" 
                    icon="pi pi-arrow-right" 
                    class="primary-action-btn"
                    (onClick)="navigateToForm(form.id)">
                  </p-button>
                  <p-button 
                    icon="pi pi-chart-line" 
                    severity="secondary"
                    [outlined]="true"
                    pTooltip="View Analytics"
                    class="secondary-action-btn"
                    (onClick)="viewAnalytics(form.id)">
                  </p-button>
                  <p-button 
                    icon="pi pi-copy" 
                    severity="secondary"
                    [outlined]="true"
                    pTooltip="Duplicate Form"
                    class="secondary-action-btn"
                    (onClick)="duplicateForm(form.id)">
                  </p-button>
                </div>
              </div>
            </ng-template>

          </p-card>
        </div>

        <!-- Add New Form Card -->
        <div class="form-card-wrapper">
          <p-card class="form-card add-new-card" (click)="createNewForm()">
            <div class="add-new-content">
              <div class="add-new-icon">
                <i class="pi pi-plus"></i>
              </div>
              <h3>Create New Form</h3>
              <p>Start building a custom order form for your business</p>
              <p-button 
                label="Get Started" 
                icon="pi pi-arrow-right" 
                severity="success"
                [outlined]="true"
                class="add-new-btn">
              </p-button>
            </div>
          </p-card>
        </div>
      </div>
    </div>

    <!-- Form Settings Dialog -->
    <p-dialog 
      header="Form Settings" 
      [(visible)]="showFormSettings" 
      [modal]="true" 
      [style]="{width: '600px'}"
      [draggable]="false"
      [resizable]="false">
      
      <div class="settings-content" *ngIf="builderState?.currentForm">
        
        <div class="settings-group">
          <h4>Basic Settings</h4>
          
          <div class="form-field">
            <label>Form Name</label>
            <input 
              pInputText 
              [(ngModel)]="builderState!.currentForm!.formName"
              (ngModelChange)="updateFormProperty('formName', $event)"
              placeholder="Enter form name">
        </div>

          <div class="form-field">
            <label>Description</label>
            <textarea 
              pTextarea 
              [(ngModel)]="builderState!.currentForm!.description"
              (ngModelChange)="updateFormProperty('description', $event)"
              placeholder="Enter form description"
              rows="3">
            </textarea>
          </div>

          <div class="form-field">
            <label>Theme</label>
            <p-dropdown 
              [(ngModel)]="builderState!.currentForm!.settings.theme"
              (ngModelChange)="updateFormSettings('theme', $event)"
              [options]="[
                { label: 'Default', value: CustomFormTheme.DEFAULT },
                { label: 'Modern', value: CustomFormTheme.MODERN },
                { label: 'Minimal', value: CustomFormTheme.MINIMAL },
                { label: 'Corporate', value: CustomFormTheme.CORPORATE }
              ]"
              optionLabel="label"
              optionValue="value">
            </p-dropdown>
        </div>
      </div>

        <div class="settings-group">
          <h4>Submission Settings</h4>
          
          <p-checkbox 
            [(ngModel)]="builderState!.currentForm!.settings.allowMultipleSubmissions"
            (ngModelChange)="updateFormSettings('allowMultipleSubmissions', $event)"
            label="Allow multiple submissions">
          </p-checkbox>

          <p-checkbox 
            [(ngModel)]="builderState!.currentForm!.settings.requireAuthentication"
            (ngModelChange)="updateFormSettings('requireAuthentication', $event)"
            label="Require user authentication">
          </p-checkbox>

          <p-checkbox 
            [(ngModel)]="builderState!.currentForm!.settings.sendEmailNotifications"
            (ngModelChange)="updateFormSettings('sendEmailNotifications', $event)"
            label="Send email notifications">
          </p-checkbox>
    </div>

        <div class="settings-group">
          <h4>Success Message</h4>
          
          <textarea 
            pTextarea 
            [(ngModel)]="builderState!.currentForm!.settings.customSuccessMessage"
            (ngModelChange)="updateFormSettings('customSuccessMessage', $event)"
            placeholder="Enter custom success message"
            rows="3">
          </textarea>
          </div>

      </div>

      <ng-template pTemplate="footer">
            <p-button 
          label="Cancel" 
          icon="pi pi-times" 
              severity="secondary"
              [outlined]="true"
          (onClick)="showFormSettings = false">
            </p-button>
            <p-button 
          label="Save Settings" 
          icon="pi pi-check" 
          severity="success"
          (onClick)="showFormSettings = false">
            </p-button>
      </ng-template>
    </p-dialog>

    <!-- Template Selection Dialog -->
    <p-dialog 
      header="Choose a Template" 
      [visible]="showTemplateDialog"
      (visibleChange)="showTemplateDialog = $event" 
      [modal]="true" 
      [style]="{width: '800px'}"
      [draggable]="false"
      [resizable]="false">
      
      <div class="template-selection">
        <div class="templates-grid">
          <div *ngFor="let template of templates" class="template-card" (click)="selectTemplate(template)">
            <div class="template-preview">
              <img *ngIf="template.previewImage" [src]="template.previewImage" [alt]="template.name">
              <div *ngIf="!template.previewImage" class="template-placeholder">
                <i class="pi pi-file-edit"></i>
              </div>
              </div>
            <div class="template-info">
              <h4>{{ template.name }}</h4>
              <p>{{ template.description }}</p>
              <div class="template-tags">
                <p-tag *ngFor="let tag of template.tags" [value]="tag" severity="secondary" size="small"></p-tag>
              </div>
              </div>
              </div>
              </div>
            </div>

      <ng-template pTemplate="footer">
                <p-button 
          label="Cancel" 
          icon="pi pi-times" 
          severity="secondary"
          [outlined]="true"
          (onClick)="closeTemplateDialog()">
        </p-button>
        <p-button 
          label="Use Template" 
                  icon="pi pi-check" 
          severity="success"
          [disabled]="!selectedTemplate"
          (onClick)="createFormFromTemplate(selectedTemplate!); closeTemplateDialog()">
                </p-button>
      </ng-template>
    </p-dialog>

    <!-- Keep remaining original views for compatibility -->
    <!-- All Forms View and Single Form View would go here -->

  </div>
</div>