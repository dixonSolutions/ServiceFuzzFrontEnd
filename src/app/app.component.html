<div class="app-container" *ngIf="!(data.isRestoringSession$ | async); else restoring">
  <!-- Toast containers for different positions -->
  <p-toast key="top-left" position="top-left"></p-toast>
  <p-toast key="top-center" position="top-center"></p-toast>
  <p-toast key="top-right" position="top-right"></p-toast>
  <p-toast key="bottom-left" position="bottom-left"></p-toast>
  <p-toast key="bottom-center" position="bottom-center"></p-toast>
  <p-toast key="bottom-right" position="bottom-right"></p-toast>
  <p-toast key="center" position="center"></p-toast>
  <p-toast key="default"></p-toast> <!-- Default toast for backward compatibility -->
  
  <app-topbar></app-topbar>
  <main class="main-content">
    <router-outlet></router-outlet>
  </main>
</div>

<ng-template #restoring>
  <div class="app-loading-overlay">
    <div class="spinner-with-logo">
      <p-progressSpinner styleClass="w-6rem h-6rem" strokeWidth="6"></p-progressSpinner>
      <img src="/servicefuzz-logo.png" alt="ServiceFuzz" class="spinner-logo" />
    </div>
  </div>
</ng-template>

<!-- Lightweight, non-duplicative subscription prompt dialog -->
<p-dialog
  [(visible)]="showSubscriptionDialog"
  [modal]="true"
  [closable]="true"
  [dismissableMask]="true"
  header="Unlock ServiceFuzz"
>
  <div class="subscription-dialog">
    <p>Subscribe to access all features. You can start with a 30-day free trial.</p>
    <div class="dialog-actions">
      <button pButton type="button" label="Start 30-day trial" (click)="redirectToStripeCheckout(true)" [disabled]="isSubscribing"></button>
      <button pButton type="button" class="p-button-warning" label="Subscribe Now" (click)="redirectToStripeCheckout(false)" [disabled]="isSubscribing"></button>
      <button pButton type="button" class="p-button-text" label="More options" (click)="goToBusinessSettings()"></button>
    </div>
  </div>
</p-dialog>
